!function(t){"use strict";t.Puroadver=function(e,s){this.eAdver=t(s).addClass("adsPuropela"),this.$el=t('<div class="puroadver"></div>').appendTo("body"),this._init(e)},t.Puroadver.defaults={headHeight:30,headCorner:50,border:1,url:"data.json",adsby:{logo:"images/ad-by-Puropela-min.png",link:"http://www.puropela.com/",txt:"ads by Puropela"}},t.Puroadver.prototype={_init:function(e){this.opts=t.extend(!0,{},t.Puroadver.defaults,e);var s=this,i=location.hostname;t.getJSON(s.opts.url,{site:i},function(t){s._setLayout(t),s._generate(t)}).fail(function(){console.log("Puroadver error")})},_setLayout:function(t){this.colWidth=Math.floor((t.theme.width-this.opts.border)/t.theme.cols-this.opts.border),this.rowHeight=Math.floor((t.theme.height-this.opts.headHeight)/t.theme.rows-this.opts.border),this.pWidth=(this.colWidth+this.opts.border)*t.theme.cols+this.opts.border,this.pHeight=(this.rowHeight+this.opts.border)*t.theme.rows+this.opts.headHeight},_initLayout:function(e){var s=this;this.$el.width(this.pWidth).height(this.pHeight).hide(),this.eAdver.append('<img src="'+e.imgadver+'" />',this._adsSignature()).click(function(e){e.stopPropagation(),s.$el.fadeIn(300);var i=s.$el.find(".pra-txt");"function"!=typeof t.fn.marquee||i.children(".js-marquee-wrapper").length||i.marquee({delayBeforeStart:500,duration:7e3})}),t("html").click(function(e){var i=t(e.target).parents(".puroadver");i.length||s.$el.fadeOut(200)})},_adsSignature:function(){var e='<a class="adsP01" href="'+this.opts.adsby.link+'"><span class="txt">'+this.opts.adsby.txt+"</span></a>";return t(e).css("background-image","url("+this.opts.adsby.logo+")").click(function(t){t.stopPropagation()})},_generate:function(e){this._initLayout(e),this._getHead(e);for(var s=this._getGist(e),i=0;i<e.set.length;i++){for(var a=0,r=t('<div class="puroadver-set"></div>').appendTo(this.$el),o=0;o<e.theme.rows;o++)for(var h=0;h<e.theme.cols;h++){var d=this._generateCell(r,e,i,a),n=this._cellPos(d.find(".front"),e,i,o,h);n.click(function(){t(this).parent().addClass("flipped")}),a++}t('<div class="puroadver-arrow"></div>').click(function(){t(this).toggleClass("active"),s.toggleClass("active"),"function"==typeof t.fn.jScrollPane&&s.jScrollPane({verticalDragMaxHeight:40})}).appendTo(r)}e.set.length>1&&this._initEvents()},_initEvents:function(){var e=this.$el.children(".puroadver-set").addClass("rotator");e.first().addClass("active"),e.children(".puroadver-cell").click(function(){var s=!0;t(this).parent().children(".puroadver-cell").each(function(){t(this).hasClass("flipped")||(s=!1)}),s&&setTimeout(function(){var t=e.filter(".active").removeClass("active"),s=t.next();t.children(".puroadver-cell").removeClass("flipped"),s.length?s.addClass("active"):e.first().addClass("active")},1500)})},_generateCell:function(e,s,i,a){var r="";return r=s.set[i].items[a]?"<div class='puroadver-cell'><div class='back' style='line-height: "+this.rowHeight+"px'><a href='"+s.set[i].items[a].url+"'><span class='txt'><img src='"+s.set[i].items[a].img+"' /></span><div class='overlay'><span class='txt'>"+s.set[i].items[a].des+"</span></div></a></div><div class='front' style='line-height: "+this.rowHeight+"px'><div class='overlay'><span class='txt'>"+s.set[i].items[a].title+"<br /><span class='old-price'>"+s.set[i].items[a].oldPrice+"</span><br /><span class='price'>"+s.set[i].items[a].price+"</span></span></div></div></div>":"<div class='puroadver-cell'><div class='back'></div><div class='front'></div></div>",t(r).width(this.colWidth).height(this.rowHeight).appendTo(e)},_cellPos:function(t,e,s,i,a){return t.css({background:"url("+e.set[s].bg+")","background-position":-(a*this.colWidth)+"px "+-(i*this.rowHeight)+"px"})},_getHead:function(e){var s='<div class="puroadver-head"><div class="pra-logo"><a href ="'+e.company.site+'"><img src="'+e.company.logo+'" /></a></div><div class="pra-txt" style="width: '+(this.pWidth-2*this.opts.headCorner)+"px; left: "+this.opts.headCorner+'px">'+e.company.text+'</div><div class="pra-more"><a href="'+e.company.link+'">more</a></div></div>';t(s).css({height:this.opts.headHeight,lineHeight:this.opts.headHeight+"px"}).appendTo(this.$el)},_getGist:function(e){for(var s='<div class="puroadver-gists">',i=0;i<e.company.gists.length;i++)s+='<div class="puroadver-cell" style="height: '+this.rowHeight+"px; width: "+this.colWidth+'px"><a style="line-height: '+this.rowHeight+'px" href="'+e.company.gists[i].url+'"><span class="txt"><img src="'+e.company.gists[i].img+"\" /></span><div class='overlay'><span class='txt'>"+e.company.gists[i].des+"</span></div></a></div>";return s+="</div>",t(s).css({height:this.pHeight-this.opts.headHeight,width:this.colWidth+this.opts.border,right:-(this.colWidth+2*this.opts.border)}).appendTo(this.$el)}},t.fn.puroadver=function(e){var s=t.data(this,"puroadver");return this.each(function(){s?s._init():s=t.data(this,"puroadver",new t.Puroadver(e,this))}),s}}(jQuery,window);